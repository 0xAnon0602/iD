var fs = require('fs');
var _ = require('../js/lib/lodash');

var maki = require('maki/www/maki-sprite.json');

// Generate CSS
var template = '.feature-{name}{background-position:-{x}px -{y}px;}\n';
var css = "/* This file is generated by make. Do NOT edit manually. */\n\n";
var images = {};

_.forEach(maki, function(dimensions, name) {
    var match = name.match(/(.*)-(12|18|24)/),
        name = match[1],
        size = match[2],
        group = images[name] = images[name] || {};
    group[size] = [dimensions.x, dimensions.y];

    if (dimensions.width === 24) {
        css += template.replace('{name}', name.replace('-24', ''))
            .replace('{x}', dimensions.x)
            .replace('{y}', dimensions.y);
    }
});

fs.writeFileSync('./css/feature-icons.css', css);
fs.writeFileSync('./data/feature-icons.json', JSON.stringify(images));
